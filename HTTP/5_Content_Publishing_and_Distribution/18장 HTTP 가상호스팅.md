## HTTP 가상호스팅



웹 호스팅은 리소스를 저장, 중개, 관리하는 일들이라고 한다. 그리고 호스팅은 `웹서버의 가장 중요한 기능중 하나`이다.

콘텐츠를 저장, 제공, 관리하는데에 있어서 **서버**가 필요하기 때문이다.



<br>

### 가상호스팅

<br>

웹 호스팅업자들은 서버 한대에 호스팅 하나를 하게되면 낭비일뿐이다. 그래서 서버 한대에 여러 호스팅 서비스를 제공할 수 있도록 했다.

가상호스팅으로,,.!

그런데 문제가 있었다.

HTTP 요청명세에는 이 가상호스팅으로 접근한 요청에 호스팅정보를 넣지 않았다.

한대에 컴퓨터에 www.yebalja.com, www.GG.com을 호스팅한다고 했을 때, 이 서버에 `GET요청 (/index.html)`을 보냈다고 해보자.

그럼 서버는 어느 호스팅의 리소스를 제공해야하는지 모른다.

=> HTTP/1.1에서 이 문제를 해결하기 위해 Host 헤더를 지원한다.



<br>

초기에 가상호스팅을 고려하지않았기 때문에 HTTP1.1을 지원하지 않는 서버는 차선책을 개발했다. 차선책은 다음과 같다.



#### URL 경로를 통한 가상 호스팅

- 거의 사용하지 않는다.

#### 포트번호를 통한 가상호스팅

- 웹 서버에 각기 다른 포트번호를 할당한다.

#### IP 주소를 통한 가상호스팅

- 가상 IP를 할당하는 방법
- 각 가상 사이트에 유일한 IP주소를 한 개 이상 부여한다.
- 클라이언트는 URL에 대한 IP주소를 찾고, 해당 IP에 있는 웹 서버와 커넥션을 맺은 후 요청을 보낸다. 해당 IP는 이에 해당하는 웹 사이트를 판단해 요청을 처리한다.
- IP주소부족문제가 발생할 수 있음.

#### Host 헤더를 통한 가상호스팅

- IP 주소 낭비를 피하기 위해 사용.
- 모든 요청에 호스트명 + 포트를 Host 확장 헤더에 포함시켜 전달한다.
- 거의 모든 브라우저가 Host헤더를 지원한다.



<br>

### 안정적인 웹 사이트 만들기



웹 사이트 장애 상황은 다음과 같다.

- 서버 다운
- 트래픽 폭증
- 네트워크 장애, 손실



#### 미러링 된 서버 팜

- `서버팜`은 서로를 대신하고, 식별할 수 있게 설정된 `웹 서버의 집합`!
- 서버팜의 서버에 있는 콘텐츠들은 한 곳에 문제가 생기면 다른 곳에서 대신 전달할 수 있도록 미러링 할 수 있다.
- 미러링된 서버는 계층적 관계를 가짐

원본 컨텐츠를 가진 서버 = 마스터 원 서버

서버팜 배포 방법 = 네트워크 스위치를 사용해 서버에 분산요청을 보내는 것

마스터 원 서버는 복제 서버에 콘텐츠를 보낼 책임이 있고,

스위치는 서버에게 요청을 전송해야 하는 책임이 있다.



분산된 미러링 서버들에게 클라이언트 요청이 특정 서버로 가는 두 가지 방법

#### HTTP 리다이렉션

- 콘텐츠에 대한 URL은 마스터 서버의 IP를 가리킴, 마스터 서버는 요청을 받는 즉시 복제 서버로 리다이렉트 시킨다.

#### DNS 리다이렉션

- 콘텐츠의 URL은 미러링된 서버의 갯수만큼 IP주소를 가리킬 수 있고, DNS 서버는 클라이언트에게 전송할 IP 주소를 `선택`할 수 있다.



### CDN 콘텐츠 분산 네트워크

- CDN은 특정 콘텐츠의 분산을 목적으로 하는 네트워크

- 네트워크의 노드는 대리서버, 프락시 서버가 될 수 있음
- 대리캐시는 미러링 된 복제 서버를 대신해 사용할 수 있고 리버스 프락시라고도 불린다.
- 특정 원 서버 집합을 대신해 대리 서버가 요청을 받는다.
- 요청 -> 대리서버 -> 특정 원서버 집합(복제 + 원서버)
- 대리서버는 요청받은 콘텐츠만 저장한다.



#### 웹사이트 빠르게 만들기

- 콘텐츠 분산 -> 콘텐츠를 사용자에게 가깝게 만들어주므로 서버-> 클라이언트 전송시간이 닽축
- 리소스 로딩속도를 좌우하는 핵심 요소는 어떻게 요청, 응답이 클-서버사이에서 연결을 맺고 데이터를 전송하는 지임.

