---
###### 1. 학습 날짜

- 2020-03-28(토)
 
---
###### 2. 학습시간

- 10:00 ~ 18:52(자가)

---
###### 3. 학습 범위 및 주제

-  도커 마무리

---
###### 4. 동료 학습 방법 

- slack (saji, yshin, Jiyang, Seongkim)

---
###### 5. 학습 목표 

- 도커 마무리

---
###### 6. 과제 제출 repository 주소

http://13.125.198.2:3000/secho/ft_server.git

---
###### 7. 상세 학습 내용

- 코드작성시간 : 4시간
  
## 생성한 컨테이너 실행
  
- 무한루프를 통한 환경유지

```shell
$ docker run -d --name 컨테이너명 이미지명 /bin/bash -c "while true; do echo 'is alive'; sleep 10; done"
$ docker attach 컨테이너명 #컨테이너실행
$ docker exec -it 컨테이너명 /bin/bash
```

- docker파일 run

```shell
$ docker buile -t 컨테이너명
$ docker run --name 컨테이너명 -it -p 80:80 -p 443:443 이미지명
```

```shell
# 전체 설치할 폴더들
$ apt-get install -y nginx && apt-get install -y vim && apt-get -y install php7.3-fpm
$ apt-get install -y php7.3cli php7.3-curl php7.3-gd php7.3-mysql php7.3-mbstring zip unzip
$ apt-get install -y mariadb-server php-mysql
$ apt-get install php-curl php-mbstring # 지워도 상관없을듯 위에 php-mysql이랑
$ apt-get install -y wget
```

## nginx 설치

```shell
$ apt-get install -y nginx
```

## php 모듈 설치

```shell
 $ apt-get install -y php7.3cli php7.3-curl php7.3-gd php7.3-mysql php7.3-mbstring zip unzip
```

## php7.3-fpm 설치

```shell
$ apt-get install -y php7.3-fpm
```

## Openssl + nginx

- 키생성 /etc/nginx/ssl 하위에서 해당 명령어 실행

- ```shell
  $ openssl req- x509 -nodes -days 365 -newkey rsa:2048 -keyout 키이름.key -out 인증서이름.crt //인증서 및 비밀 키 생성
  ```

  /etc/nginx/sites-availble/default 폴더에 해당 내용으로 변경

```shell
server {
	listen 80 default_server;
	listen [::]:80 default_server;
	 listen 443 ssl default_server;
	 server_name _;
	ssl on;
	ssl_certificate /etc/nginx/ssl/ft_server.crt;
	ssl_certificate_key /etc/nginx/ssl/ft_server.key;
	root /var/www/html;
	index index.php index.html index.htm index.nginx-debian.html;
	server_name _;
	location / {
		try_files $uri $uri/ =404;
	}
	location ~ \.php$ {
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		include fastcgi_params;
		fastcgi_pass unix:/run/php/php7.3-fpm.sock;
		fastcgi_read_timeout 300;
	}
	location ~ /\.ht {
		deny all;
	}
}
```

```shell
$ nginx -t 
$ service nginx restart
```

- /var/www/html폴더안에 index.php 파일 생성 후 해당 내용으로 저장

- ```
  <?php phpinfo(); ?>
  ```

  

- https://내  IP/ 로 접속해보기.. PHP  version나오면 nginx + php 연동 끝

## mariadb-server 설치

```shell
$ sudo apt-get install -y software-properties-common dirmngr
$ sudo apt-key adv --fetch-keys 'https://mariadb.org/mariadb_release_signing_key.asc'
$ sudo add-apt-repository 'deb [arch=amd64] http://download.nus.edu.sg/mirror/mariadb/repo/10.3/debian buster main'

//Once the key is imported and the repository added you can install MariaDB with:

$ sudo apt update
$ sudo apt install -y mariadb-server # 이렇게 전부 따라가도 되고 아니면 맨 마지막줄만 해도 될듯..
```

## phpMyAdmin 설치

```shell
$ wget -O /var/www/phpmyadmin.zip https://files.phpmyadmin.net/phpMyAdmin/4.9.5/phpMyAdmin-4.9.5-all-languages.zip
$ unzip /var/www/phpmyadmin.zip -d /var/www # 압축풀기
$ mv phpmyadmin4.8 phpmyadmin # 이름 변경해야함, www/html에다가 설치해야됨.
```

## Mysql 설정

```shell
echo "CREATE DATABASE wordpress;" | mysql -u root --skip-password
echo "GRANT ALL PRIVILEGES ON wordpress.* TO 'root'@'localhost' WITH GRANT OPTION;" | mysql -u root --skip-password 

# mysql> create database wordpress; mysql> grant all privileges on wordpress.* to wordman@localhost identified by 'wordmanpw' with grant option;

# wordpress.*은 wordpress 라는 DB에 속하는 모든 테이블에 권한을 부여한다는 것
# root@localhost는 root 사용할 사용자이름, localhost는 접속위치
# 'wordmanpw'는 사용할 패스워드 입력
# 출처: https://webdir.tistory.com/98 [WEBDIR]
echo "update mysql.user set plugin='mysql_native_password' where user='root';" | mysql -u root --skip-password
echo "FLUSH PRIVILEGES;" | mysql -u root --skip-password
```

```shell
$ service mysql restart
# https://ip/phpmyadmin/index.php 테스트해보기
```

## phpMyAdmin에 접속해보기 위해서 계정 비밀번호 설정

```shell
$ mysql -u root
MariaDB [(none)]> use mysql;
MariaDB [mysql]> update user set plugin='mysql_native_password' where user='root';
MariaDB [mysql]> flush privileges;
MariaDB [mysql]> quit;
$ sudo mysql -u root
MariaDB [(none)]> set password = password("새로운 비밀번호 입력");
- phpMyAdmin에 접속 가능
```

## WordPress 설치

```shell
$ wget -c https://wordpress.org/latest.tar.gz
$ tar -xvzf latest.tar.gz
$ mv wordpress /var/www/html
$ mv /tmp/wp-config.php /var/www/html/wordpress #미리 작성한 wp-config.php를 wordpress에 넣기
```

## Wp-config.php 파일 설정

- https://swiftcoding.org/wp-config-file









### 결과창

- nginx

 ![nginx](https://user-images.githubusercontent.com/55486644/77820285-7261e100-7124-11ea-8155-8e884b2bf114.JPG)

- nginx + php

 ![nginx+php](https://user-images.githubusercontent.com/55486644/77820286-7261e100-7124-11ea-93d3-336d0eccb7c2.JPG)

- SSL
![https_ssl](https://user-images.githubusercontent.com/55486644/77820282-70981d80-7124-11ea-87c0-6ce60fcfdffd.JPG)

- phpMyAdmin mysql
![phpmyAdmin](https://user-images.githubusercontent.com/55486644/77820287-73930e00-7124-11ea-92b6-592c20a01da4.JPG)

- wordpress

![wordpress site](https://user-images.githubusercontent.com/55486644/77820289-742ba480-7124-11ea-9636-625170c65ff4.JPG)

---
###### 8. 학습 내용에 대한 개인적인 총평

- dockerfile까지 작성하고 작성한 파일들을 복사 그리고 설정에 맞춰 수행하는 쉘스크립트까지 작성했다.
전체적인 과정을 그렇게 어렵지 않았으나 자료들을 정리하고 이에 따라 맞춰가는게 복잡했다. 슬랙에 올라온 가이드라인을 참고하지 않았다면 더 시간이 오래 걸렸을 것 같다.
간혹 에러가 발생했지만 이전에 정리해두었던 자료들을 다시 참고하면서 수정하니 시간이 훨씬 단축되었다.
이번 과제는 구현보다는 자료들을 정리하고 도커에 대해 이해하는 것을 주로 다루어서 코딩하는데 시간을 그렇게 투자하지는 않았다.
그러나 자료들을 더욱 체계적으로 정리할 필요를 느꼈다.
---
###### 9. 다음 학습 계획 (최소 5줄 이상)

- cub3d 과제 시작
- cub3d 과제 자료 찾기
- 내용정리 체계적으로 파일명에 맞추어 진행하기
- 느슨해지지 않기!!
- 슬랙에 동료학습 진행하기