

###### 1. 학습 날짜

- 2021 - 01 - 12(화)

---

###### 2. 학습시간

- 10:00 ~ 18:00

---

###### 3. 학습 범위 및 주제

- 쿠버네티스

---

###### 4. 동료 학습 방법 

- daelee, taelee, jehong, mihykim

---

###### 5. 학습 목표 

- 쿠버네티스

---

###### 6. 상세 학습 내용

- 코드작성시간 :  시간

- ### POD

  - 쿱네 배포단위
  - 파드 안에 하나 또는 여러 컨테이너가 돌아감.

  ⇒ `yaml` 이라는 파일로 파드를 정의할 수 있다.

  ### YAML 필수요소

  쿠버네티스는 리소스를 관리할 때 `name`과 `label`을 이용합니다.

  [필수 요소](https://www.notion.so/b175ab640d3c4b3593f51ed675068579)

  `version`, `kind`, `metadata`, `spec`는 리소스를 정의할 때 반드시 필요한 요소입니다.

  ### livenessProbe

  - 컨테이너가 정상적으로 동작하는지 체크. 정상동작이 아니면 재시작함

  ### 다중컨테이너

  ```
  piVersion: v1
  kind: Pod
  metadata:
    name: counter
    labels:
      app: counter
  spec:
    containers:
      - name: app
        image: ghcr.io/subicura/counter:latest
        env: => 컨테이너 환경변수
          - name: REDIS_HOST
            value: "localhost"
      - name: db
        image: redis
  ```

  spec에 컨테이너를 또 작성해줌

  카운터라는 파드안에 app,db이라는 이름의 컨테이너가 돌아감.

  같은 파드에 컨테이너가 있기에 둘은 localhost로 접속가능

  ### 레플리카셋 ⇒ kind: ReplicaSet

  - 라벨을 체크해서 원하는 수의 파드가 없으면 새로운 파드를 생성.

  ```
  apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    name: echo-rs
  spec:
    replicas: 1
    selector:
      matchLabels:
        app: echo
        tier: app
    template:
      metadata:
        labels:
          app: echo
          tier: app
      spec:
        containers:
          - name: echo
            image: ghcr.io/subicura/echo:v1
  ```

  [Untitled](https://www.notion.so/84398e69e8674034a669cf20262d1ebf)

  ⇒ 어떻게 이 파드를 추적할 것인가? ⇒ 셀렉터

  ⇒ 몇개를 새로 생성할 것인가? ⇒ 레플리카스

  ⇒ 어떤 파드를 생성할 것인가? ⇒ 템플릿

  파드의 라벨 확인 명령어

  kubectl get pod --show-labels

  ### Deployment

  - 파드들의 이미지 버전을 새로 업데이트하거나 롤백할 때사용
  - ⇒ 레플리카셋을 디플로이먼트로 만들고 이미지를 업데이트하면 기존 파드들 삭제하고 새로운 이미지의 새로운 파드들을 생성함.
  - 서비스가 끊기면 안되므로 배포전략을 따라서 수행함 ⇒ strategy: ...

  ### Service

  - 파드는 쉽게 사라지고 생겨서 직접 통신하기 힘듬 → ip가 매번 바뀌므로.
    - 따라서 고정된 ip 서비스를 만들고 그 서비스를 통해 파드에 접근하는 방식 사용
  - 노출 범위에 따라 클러스터ip, nodeport, loadbalancer가 있다.

  ### nodeport

  spec.ports.nodePort	노드에 오픈할 Port (미지정시 30000-32768 중에 자동 할당) ⇒ 외부에서 port:xxxx 로 지정된 클러스터에 접근하기 위해 노드(30000~ )포트를 거쳐서 해당 파드에 접근가능.

  ### loadbalancer

  노드포트는 노드가 사라지는 경우가 발생시 어떤 노드로 향해야하는지가 알 수 없음

  따라서 모든 노드를 바라보는 로드밸런서가 있어야 어떤 노드로 접속시킬 것인지 알 수 잇음

  ```
  apiVersion: v1
  kind: Service
  metadata:
    name: counter-lb
  spec:
    type: LoadBalancer
    ports:
      - port: 30000
        targetPort: 3000
        protocol: TCP
    selector:
      app: counter
      tier: app
  ```

---

###### 7. 학습 내용에 대한 개인적인 총평

- 쿠버네티스에 대한 기초 학습

###### 8. 다음 학습 계획

- 쿠버네티스