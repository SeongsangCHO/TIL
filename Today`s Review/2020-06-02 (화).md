---
###### 1. 학습 날짜

- 2020 - 06 - 02(화)
 

---

###### 2. 학습시간

- 10:00 ~ 12:00
- 13:00 ~ 17:00
- 19:00 ~ 23:00

---

###### 3. 학습 범위 및 주제

- JS 지뢰찾기 구현 및 스터디커뮤니티 DB설계

---

###### 4. 동료 학습 방법 

- slack (saji, yshin, Jiyang, Seongkim)

---

###### 5. 학습 목표 

- 지뢰찾기 중 재귀함수를 통해 지뢰가 없는 구역을 체크합니다.
- 스프링을 통해 스터디 커뮤니티 구현을 위하여 DB설계를 진행합니다.

---

###### 6. 상세 학습 내용

- 코드작성시간 :  6시간



## 자바스크립트 #09 지뢰찾기(우클릭으로 깃발꼽기, 물음표기능, 주변 지뢰갯수 세기)





우클릭을 통해 깃발을 꼽는 기능을 작성합니다.

td에 대해 클릭 이벤트리스너를 등록해야하고, 클릭된 부분을 ! 문자로 변경합니다.

우클릭에 대한 이벤트는 contextmenu이벤트 입니다.

비동기함수로 실행되므로 td를 생성할 때 모든 td객체에 대해  contextmenu 이벤트리스너를 등록해야합니다.



```javascript
   for(var j = 0; j < hor; j++)
         {
             arr.push(1);
             var td = document.createElement('td');
             td.addEventListener('contextmenu',function(e){
                 e.preventDefault();
                 console.log('event!');
                 //우클릭된 특정행, 열을 찾기위한 인덱스 선언
                 var trParent = e.currentTarget.parentNode;
                 var tbodyParent = e.currentTarget.parentNode.parentNode;
                 //현재 우클릭된 td는 trParent(tr)에 속한 유사배열입니다.
                 //이를 배열의 indexOf메소드를 사용하기 위해 Array.prototype을 사용합니다
                 //https://poiemaweb.com/js-array
                 var col = Array.prototype.indexOf.call(trParent.children, e.currentTarget);
                 var row = Array.prototype.indexOf.call(tbodyParent.children, trParent);
             }
           }
```





우클릭을 했을 때 클릭이벤트와 마찬가지로 몇번째 행, 몇번째 열인지 알아내는 코드를 작성합니다.

e.currentTarget은 이벤트가 바인딩된 요소를 반환합니다. 여기서 td가 이벤트로 등록되어있으니 td를 가리킵니다.

e.target은 이벤트 버블링 최말단 요소를 반환합니다. 마찬가지로 td가 최말단이므로 td를 가리킵니다.



```javascript
<div onclick="checkTarget();">
    <span>test</span>
</div>
function checkTarget(event) {
    console.log(event.target); // span을 가리킴
    console.log(event.currentTarget은); // div를 가리킴
} //http://wiki.simuruk.com/index.php/javascript_event.target%EC%99%80_event.currentTarget_%EC%B0%A8%EC%9D%B4?TheOrder=1 출처
```





### 배열리터럴 객체리터럴

https://poiemaweb.com/js-array



위의 방식으로 우클릭된 td요소의 행,열위치를 알았으니 이제 이에 대한 처리를 진행합니다.

한번 클릭시 !로 그리고 두번째 클릭에는 ? 다시 클릭했을때 원래의 상태로 돌아오게 만듭니다.



```javascript
        if(e.currentTarget.textContent === '' || e.currentTarget.textContent === 'X')
                 {
                     e.currentTarget.textContent ='!';
                 }
                 else if(e.currentTarget.textContent === '!')
                 {
                     e.currentTarget.textContent = '?';
                 }
                 else if(e.currentTarget.textContent === '?')
                 {
                     if(dataSet[row][col] === 1)
                        e.currentTarget.textContent = '';
                    else if(dataSet[row][col] === 'X')
                        e.currentTarget.textContent ='X';
                 }
```



현재 클릭된 곳의 text가 공백이거나 X(지뢰)이면 !로 만들고, 현재 !이면 ?로, 그리고 ?이면 공백이나 지뢰로 만듭니다.

지뢰를 심을때 dataSet의 데이터를 X로 지정해주었고 그렇지 않은 부분은 전부 1로 초기화해두어서 1일때는 공백으로, 그리고 X일때는 X로 그대로 나오게 작성합니다.



#### 주변 지뢰갯수 세기



공백을 클릭했을때 주변 지뢰 갯수를 세고 지뢰를 클릭했을때 '펑'글자로 바꾸도록 합니다.

td에 대한 클릭이벤트리스너를 등록하고 마찬가지로 행,열위치를 찾은 다음, 주변 8칸에 대해서 dataSet이 X인 값들을 카운트해줍니다.



```javascript
 if(dataSet[row][col] === 'X')
     e.currentTarget.textContent = '펑';
  else
  {
     //해당하는 원소들을 return이 true인 요소만 모아서 그것에 대한 크기를 구한다
     var around = [ dataSet[row][col - 1],dataSet[row][col + 1] ];
     if(dataSet[row - 1])
        around = around.concat(dataSet[row - 1][col - 1],dataSet[row - 1][col], dataSet[row - 1][col + 1]);
     if(dataSet[row + 1])
        around = around.concat(dataSet[row + 1][col - 1],dataSet[row + 1][col],dataSet[row + 1][col + 1]);
      
      var aroundMineCnt = around.filter(function(v)
        {
         return v === 'X';
         }).length;
       //주변에 지뢰가 몇개 있는지 확인
      e.currentTarget.textContent = aroundMineCnt;
```



around배열은 주변 8칸의 원소들의 값을 갖는 배열입니다.

concat메소드를 통해 기존 배열에 덧붙이는 작업을 진행합니다.

만약 클릭된 위치의 주변 원소중 데이터가 없는 위치, (사각형의 변에 해당하는 위치가 클릭됐을때) dataSet의 윗줄 또는 아랫줄의 데이터가 존재할 때 존재하는 원소들을 덧붙여주는 concat을 수행합니다.

around배열에는 현재 클릭된 위치 주변 8원소의 값들이 존재합니다.

filter메소드를 이용해 원소의 값이 X인 값들의 길이를 구할 수 있습니다.

aroundMineCnt에는 값이 X인 원소들의 갯수를 가지고 있습니다.

이를 통해 현재 클릭된 위치의 주변 8개를 탐색해 주변 지뢰갯수를 화면에 뿌려줄 수 있습니다.





---

###### 7. 학습 내용에 대한 개인적인 총평

- 지뢰찾기의 스코프, 클로저에 대한 기본적인 내용을 학습하고 지뢰찾기 구현을 진행했습니다.

- todoList는 하지 않기로 정했습니다. 이것보다 게시판의 DB를 직접 설계해보고 구현해보는 편이 더 좋을 것 같습니다.

- 구현할 게시판의 기능을 정리했습니다.  다음과 같습니다.

- 게시글을 작성할 수 있습니다.

  게시글을 수정할 수 있습니다.

  게시글을 삭제할 수 있습니다.

  게시글을 조회할 수 있습니다.

  조회를 제외한 나머지 행위는 로그인이 필요합니다.

  로그인을 하기 위해서 회원가입을 해야합니다.

  글은 20개씩 페이지네이션이 되어야 합니다.

  각 포스팅에는 댓글을 달 수 있습니다.

  포스팅에 좋아요를 누를 수 있습니다.

  게시글 조회할 때마다 조회수가 올라갑니다.

  게시글에 map이 포함됩니다.

  게시글 작성자는 map의 위치를 검색해서 마커를 찍을 수 있습니다.

  게시글 작성시 도시, 평일 오전 오후, 주말 오전 오후로 checkbox를 선택하여 태그이미지를 추가할 수 있습니다.

- 이를 위해 DB 설계도 진행했습니다. 멈추기보다 천천히 진행할 것입니다.

###### 8. 다음 학습 계획

- JS지뢰찾기 마무리
- 게시판 구현을 위한 설정 및 템플릿 조사
- 백준문제
- 스프링 책 학습진행
- 자료정리

