

###### 1. 학습 날짜

- 2020 - 08 - 14(금)

---

###### 2. 학습시간

- 10:00 ~ 18:00

---

###### 3. 학습 범위 및 주제

- 리덕스 적용 완료

---

###### 4. 동료 학습 방법 

- daelee, taelee, jehong, mihykim

---

###### 5. 학습 목표 

- 리덕스 적용을 마무리하고 내용정리도 끝낸다.

---

###### 6. 상세 학습 내용

- 코드작성시간 : 3  시간

### 5.5단계 랜더링-리랜더링, 비동기처리

초기랜더링에서 새로운 상태를 반환받아서 바로 사용할 수 없다. 처음엔 `빈 데이터`를 가지고 랜더링을 수행해야한다.

나는 액션생성함수를 비동기로 처리하였다. 그리고 비동기로 처리하지 않아도 상태가 변화되는 상황이라면 `리랜더링`이라는 과정을 거쳐야한다.

리액트가 랜더링을 실행하는 과정은 다음과 같다.

1. Props가 변경되었을 때
2. State가 변경되었을 때
3. `*forceUp*date()`[ ](https://reactjs.org/docs/react-component.html#forceupdate)를 실행하였을 때
4. **부모 컴포넌트가 렌더링되었을 때**

우린 2번에 해당한다. 따라서 `리랜더링`을 수행한다.



현재 우리는 `hooks`를 사용하고 있으므로 `componentDidMount`와 같은 라이프사이클메소드를 사용할 수 없다.

대신 `useEffect`라는 메소드가 존재한다.

이는 컴포넌트가 랜더링되거나 업데이트될 때마다 수행되는 함수이다.

우린 랜더링되었을 때 수행되도록 하고, 새로운 상태로 변화하게 해서 컴포넌트를 리랜더링하도록하게 작성할 것이다.

<br>

### 5.99 단계 : useEffect에서 액션생성 및 리듀서 호출

<br>

컴포넌트가 초기에 빈 값으로 랜더링된다는 것을 알았다.

그럼 빈 값일 때 예외를 처리하도록 해야한다.

이 때 사용한 것이 ECMAScript추가문법에 Optional Chaining, Nullish coalescing Operator이다.

`?.` 연산자를 통해서 앞의 값이 Null 또는 Undefined이라면 undefined로 반환하고, 

`??`는 const a = data ?? [] ; - 앞의 값이 Null또는 Undefined라면, 뒤의 값을 할당하는 문법이다.

이를 이용해 초기 랜더링시 예외처리를 진행하고, 리랜더링에서 `useEffect`내에서 데이터를 불러온다. 이 때 `??`연산자를 이용하여 빈 값이 아닌 불러온 데이터를 할당해 랜더링하도록 하였다.

```javascript
  const faqData = useSelector((state) => state.faqReducer);
  const dispatch = useDispatch(); // 디스패치 사용하도록하기

  useEffect(()=>{
    getFaqData().then(function(result){
      dispatch(result) 
    });
  },[]);
  const dataList = faqData.data[program] ?? [];
```

`getFaqData`는 액션생성함수이고 이에 대한 결과는 `result`로 액션을 반환하는 콜백함수 내에서 리듀서를 호출하도록 했다.

비동기함수를 호출하는데 `async, await`를 사용했다. 그런데 `then`이라는 메소드와 콜백함수를 거치지 않고는 바로 얻어온 데이터를 사용할 수 없었다. 이는 `promise`라는 비동기 처리를 위한 객체와 연관이 있었다.

`promise`는 비동기 처리 후 반환되는 객체인데 상태값이 존재한다. `대기, 이행, 거절` . 

axios로 통신을 진행한 후 반환된 `promise`의 상태는 `이행` 상태였다. 이를 그냥 사용하려고 하자 , 데이터에 접근할 수가 없었는데 then, 콜백함수를 사용해 해결할 수 있었다. [promise에 대한 설명](https://joshua1988.github.io/web-development/javascript/promise-for-beginners/)

**응답을 받아오면, then이나 catch로 분기하여 결과나 오류를 반환하도록 해야한다는 것을 알게되었다.**





<br>

### 6단계 : 반환받은 새로운 상태로 데이터 출력

<br>

지금까지 한 과정으로 데이터 출력까지 마무리되었다.

디스패치에서 액션을 리듀서로 전달해 type에 따른 분기로 해당하는 상태값을 반환하여 이 값으로 리랜더링을 진행해 새로운 상태값을 기반으로 컴포넌트들을 그려준다.

상태값이 변화할 때마다 state는 변할 것이며 그 때마다 re-rendering이 발생할 것이다.









### 배포시 에러발생

리덕스를 적용하고 `npx next build`로 배포파일을 생성하는데 다음과 같은 에러가 발생했다.

```
Automatically optimizing pages ..root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/about". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/boostcamp". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/ftseoul". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/likelion". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/soma". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/ssafy". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/woowa". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function
root Reducer
root Reducer
root Reducer

Error occurred prerendering page "/404". Read more: https://err.sh/next.js/prerender-error
TypeError: middleware is not a function

> Build error occurred
Error: Export encountered errors on following paths:
        /
        /404
        /about
        /boostcamp
        /ftseoul
        /likelion
        /soma
        /ssafy
        /woowa
    at exportApp (/home/liasqui31/yebalja.com/front/node_modules/next/dist/export/index.js:22:1166)
    at processTicksAndRejections (internal/process/task_queues.js:97:5)
    at async build (/home/liasqui31/yebalja.com/front/node_modules/next/dist/build/index.js:36:218)

```

- store에 사용하지 않는 리듀서를 명시해놓음
- index.js라는걸 초기에 찾아서 들어가는 것 같음 따라서 기존의 index.js 삭제
- index.js를 참조했던 store에서 import 삭제
- => 해결!

---

###### 7. 학습 내용에 대한 개인적인 총평

- 배포할 때 예정되지 못한 에러가 발생했었다
- git merge를 진행할 때 불필요한 코드들과 주석을 다는 습관을 들여야겠다.

###### 8. 다음 학습 계획

- HTTP 학습 및 정리

