---
###### 1. 학습 날짜

- 2020-03-25(수)
 
---
###### 2. 학습시간

- 13:40 ~ 23:10(자가)

---
###### 3. 학습 범위 및 주제

-  도커 학습

---
###### 4. 동료 학습 방법 

- slack (saji, yshin, Jiyang, Seongkim)

---
###### 5. 학습 목표 

- 도커 학습

---
###### 6. 과제 제출 repository 주소

http://13.125.198.2:3000/secho/ft_server.git

---
###### 7. 상세 학습 내용

- 코드작성시간 : 3시간

- nginx웹서버는 마크업 언어 파일만 해석할 수 있을 뿐, php는 해석하지 못한다. 그래서 nginx + php조합에서는 php-fpm이 대신 해석해준다. php-fpm을 설치하면 php가 같이 설치된다.

- 5.6보다 7이상버전이 성능향상이 큼.

- ```
  $apt-cache policy php // php설치정보 보기 해당 php버전으로 모듈, fpm 설치 및 start.
  ```

  ```
  $ sudo apt-get install php7.2-cli php7.2-curl php7.2-gd php7.2-mysql php7.2-mbstring zip unzip // php모듈 한꺼번에 설치
  ```

  ```
  $ service php7.3-fpm start //php-fpm 시작
  ```

  # 

##  Nginx + PHP | PHP해석을 위한 NGINX 설정 및 보안설정

-  https://swiftcoding.org/installing-php7-2-fpm

- https://swiftcoding.org/nginx-routing#knowledge nginx 웹서버 라우팅 설 정하기 – 도메인 IP 연결, www 리다이렉팅

- nginx가 php를 해석, 처리하도록 적용하기 위해서는 conf(설정)파일 수정해주어야함

- /etc/nginx/conf.d/default.conf
- /etc/nginx/sites-available/default (둘중 하나인데, 본인 경우는 이 부분)

그러나 default 파일의 권한은 -rw-r--r--으로 수정할 수 없음. 

```
$ sudo chgrp '사용자명' /etc/nginx/sites-available/default // 사용자그룹을 본인 계정으로 변경, SFTP로 접속한 ubuntu 사용자로도 편집할 수 있고 나중에 이 설정파일을 변경할때 자신이 원하는 텍스트편집기를 사용할 수 있어서 편리할 것
$ sudo chmod 664 /etc/nginx/sites-available/default
```

### defalut file 내용

![default file1](https://user-images.githubusercontent.com/55486644/77531260-fa9e7700-6ed5-11ea-9010-80869101a8a0.JPG)
![default_file2](https://user-images.githubusercontent.com/55486644/77531265-fbcfa400-6ed5-11ea-8eb3-71fda02fabc3.JPG)

- 파일 저장 후 

- ```
  $ nginx -t // 문법 에러가 없는지 확인.. successful이나오면
  $ service nginx restart로 nginx 재시작
  ```

- var/www/html 폴더안에 index.php 파일 생성하고 <?php phpinfo(); ?>

  ![nginx+php](https://user-images.githubusercontent.com/55486644/77531760-cc6d6700-6ed6-11ea-95e6-fb1dfa39b208.JPG)

- 상기화면이 출력되면 제대로 되는 것



## Mariadb-server설치

```
$ apt-cache policy mariadb-server // 설치정보 확인
```



- mariadb 레포지토리 세팅방법 https://downloads.mariadb.org/mariadb/repositories/#distro=Debian&distro_release=buster--buster&mirror=nus&version=10.3

```c
//Here are the commands to run to add MariaDB to your system:

$ sudo apt-get install software-properties-common dirmngr
$ sudo apt-key adv --fetch-keys 'https://mariadb.org/mariadb_release_signing_key.asc'
$ sudo add-apt-repository 'deb [arch=amd64] http://download.nus.edu.sg/mirror/mariadb/repo/10.3/debian buster main'

//Once the key is imported and the repository added you can install MariaDB with:

$ sudo apt update
$ sudo apt install mariadb-server
```

## 도커허브사용법

```
$ docker commit [컨테이너 id] [이미지id:태그]
$ docker login
//태그부여
$ docker image tag [이미지id:tag] [레포(도커허브아이디와 같아야함)/변경할 이미지id:태그]
$ docker pus [레포/이미지id:태그]
```



---
###### 8. 학습 내용에 대한 개인적인 총평

- debian환경에서 nginx, php연동 그리고 mariadb설치를 진행했다. 이제 이를 도커파일로 작성해 이미지를 생성하여 dockerhub에 push하면 어디서든 따로 설정할 필요없이 이미지만 받으면 설정한 환경을 이용할 수 있다.
- dockerfile작성하기 위해 자료정리, 그리고 설치하기까지 시간이 오래걸리는데 이를 단축하기 위한 방법도 고안해보아야할 것 같다.
- docker tag설정하는데 헷갈리는게 많았다. 일일히 하나씩 쳐보면서 결과를 비교해보고 원하는 값이 나올때마다 코드를 정리했다.
- dockerhub에 만든 이미지파일을 push하는데 성공했다. docker tag지정할때 레포지토리/id:태그를 맞춰야 에러없이 진행할 수 있다.

---
###### 9. 다음 학습 계획 (최소 5줄 이상)

- nginx php 환경구축한 후 테스트해보기
- 해당 기능을 수행할 수 있는 도커파일 생성해보기
- mysql, phpMyAdmin 설치 및 테스트해보기
- 이에 해당하는 도커파일 수정하기
- 내용 정리