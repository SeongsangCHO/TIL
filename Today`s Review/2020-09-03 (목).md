

###### 1. 학습 날짜

- 2020 - 09 - 03(목)

---

###### 2. 학습시간

- 10:00 ~ 18:00

---

###### 3. 학습 범위 및 주제

- 리액트 강의

---

###### 4. 동료 학습 방법 

- daelee, taelee, jehong, mihykim

---

###### 5. 학습 목표 

- 리액트 인피니트스크롤,faker, eslint, shortid라이브러리 사용

---

###### 6. 상세 학습 내용

- 코드작성시간 :  5 시간



## 4.5 ~ 4.7 강의

### 1. Saga쪼개기 



```react
//sagas/user.js
import { ... } from 'redux-saga/effects';

//관련된 함수들 모으기
function* ...(){
...
}

export default function* userSaga() {
	yield all([
	fork(watchLogIn),
	fork(watchLogOut)
	])
}
```



```react
//sagas/index.js

import { all, fork } ...
import postSaga from './post';
import userSaga from './user';

export default function* rootSaga(){
    yield all([
        fork(postSaga),
        fork(userSaga),
    ]);
}
```

이와 같은 방법으로 `saga`도 쪼개는 과정이 필요하다.

<br>



### 2. 로그인 액션 수정 

비동기는 항상 `REQUEST, SUCCESS, FAILURE`로 만듦

로그인할 때 REQUEST 상태에  `isLoggingIn, Out`액션을 만들어서 로딩중이면 버튼에 isLoding prop를 추가해 로딩으로 변하게 추가함.

로그인 성공/실패상태-> LoggingIn/Out :false

로그인 인, 아웃 요청 -> LoggingIn/Out : true





1. 로그인폼에서 로그인을 한다.
2. ID, PW를 적고 로그인을 누름
3. `dispatch(loginRequestAction({id,pw}));`수행
4. `sagas/user.js`의 `takeLatest(...,login)` 실행
5. `sagas/user.js`의 `function* login(action)`실행하면서 , `yield put`으로 액션실행과 함께 `reducer`에서 `LOG_IN_REQUEST`가 실행됨

6. `isLoggedIn` state에 따라, 출력되는 컴포넌트를 삼항연산자로 지정
7. reducer, saga가 잘 적용되어있는지 확인해볼 것

<br>

#### 2.1 액션과 상태정리

- 액션과 상태 변수명이 헷갈릴 수 있기에 다르게 할 필요가 있음.



```react
//서버쪽 주소구조할 때 사용할 API function
return axios.post(`/api/post/${data.postId}/comment`); 
```

<br>

### 3.바뀐 상태 적용, eslint 점검

[vs코드에서 eslint 설정하기 링크](https://steadyzest.tistory.com/20)

eslint 엄격하게 하기

- `npm i -D babel-eslint eslint-config-airbnb eslint-plugin-import`
- `npm i -D eslint-plugin-react-hooks`
- `"parser":"babel-eslint` : babel이 해석해서 최신문법도 에러발생을 안하도록 설정
- `"extends" : [ "airbnb"]` 코드를 빡세게 잡는 에어비앤비로 적용
- `npm i -D eslint-plugin-jsx-a11y` - 시각장애인, 색맹 대상으로하는 스크린리더관련을 평가하는 플러그인

- `"rules" : { "끄고싶은것들 ": off 또는 0 }`으로 제거.

![image](https://user-images.githubusercontent.com/55486644/91981560-ff5c3680-ed63-11ea-8969-766423eecb62.png)

- 꺼도되는 것들 (제로초 피셜)

<br>

## 4.8, 9 Saga로 게시글작성 ,삭제적용하기

<br>

### 1. 더미데이터 관련한 라이브러리(shortid, faker)

- 더미데이터로 진행하다보면 id값이 고정되는 귀찮음이 생기는데 `shortid`라는 라이브러리를 사용하면 id생성해줌
  - `shortId.generate()`
- `faker`라이브러리는 각종 더미데이터를 만들어줌!

<br>

#### 1.1 faker

`npm i faker`

`import faker from 'faker'`



<br>



#### 2. 게시글 삭제

```react
//sagas/user.js

case REMOVE_POST_OF_ME:
	return {
		...state,
		me: {
			...state.me,
			Posts: state.me.Posts.filter((v) => v.id !== action.data),
			//게시글을 지우기 위해선 filter을 이용한다
		}
	}
```

불변성을 꼭 지켜야한다.

상태관리에 있어서 state를 변경할 때 `setState`를 통해서만 업데이트 해주어야하고, 업데이트 과정에서 기존 객체값을 절대로 직접 수정해선 안된다.

가상 DOM에서 랜더링을 마치고, `diffing`알고리즘을 통해 변화가 일어나는 부분만 업데이트가 된다.

`setState`를 통해 변경하지 않으면 리랜더링이 되지 않는다.



`...state`를 사용하는 이유임. -> 기존 객체는 나머지 매개변수로 건들이지 않고, 새 객체를 생성하며 `불변을 유지하면서` 값을 `업데이트`할 수 있는 것.

이런 작업을 쉽게 해주는 것이 `immer`! Immutable.js와 비교도 안되게 좋음.



<br>



### 2. immer  

기존 리듀서에서 불변성을 지키는 것과  immer도입의 차이점은

`swtich case`문에서 `...`나머지 매개변수를 사용할 필요가 없다는 것과 새로운 객체 `{ }` 리터럴로 감싸면서 새로운 상태를 반환할 필요가 없어짐. `draft`로만으로 이게 됨

hooks엔 `use-immer`를 사용하면 됨

여기서 다룰건 `immer`



<br>

##### 사용법

`npm i immer`

`import produce from 'immer'`

불변성 지옥에서 우리를 구원해줄 `immer`

애초에 코딩하기전에 `immer`를 도입해버리자.

```react
// reducer- 불변성을 지키면서 이전 상태를 액션을 통해 다음 상태로 만들어내는 함수


//state가 draft로 바뀜, 불변성 상관없이 막 바꿔두됨 immer가 불변성 지켜서 다음상태로 만들어줌
const reducer = (state = initailState, action) => {
	return produce(state, (draft) => {
	switch (action.type){
		case: ADD_POST_REQUEST:
			draft.addPostLoading: true;
			...
	}
	});
}
```



<br>

##### 코드로서의 차이점

`immer 도입 전`

```react
case ADD_COMMENT_SUCCESS: {
    //불변성을 지키기위한 부분//
	const postIndex = state.mainPosts.findIndex((v) => v.id === action.data.postId);
	const post = { ...state.mainPosts[postIndex] };
	post.Comments = [dummyComment(action.data.content), ...post.Comments];
	const mainPosts = [...state.mainPosts];
	mainPosts[postIndex] = post;
    //불변성을 지키기위한 부분//
	return {
		...state,
		mainPosts,
		addCommentLoading: false,
		addCommentDone: true,
	};
}
```

<br>

`immer 도입 후`

```react
case ADD_COMMENT_SUCCESS: {
    //알아서 불변성을 유지해주니, 바꿀것만 바꾸면 됨.
	const post = draft.mainPosts.find((v) => v.id === action.data.postId);
	post.Comment.unshift(dummyComment(action.data.content));
	draft.addCommentLoading = false;
	draft.addCommentDone = true;
	break;
}
```



<br>



`redux-toolkit`을 따라가도 좋음

`placeholder.com` <- 크기별로 더미이미지를 제공함



<br>



## 4.12 인피니트 스크롤 적용

<br>

`draft.hasMorePosts = draft.mainPosts.length < 50;`

-> 특정 갯수만큼 게시글을 보여주기 위한 `true, false`설정



```react
useEffect(() => {
	function onScroll(){
        console.log(window.scrollY, document,documentElement.clientHeight, document,documentElement.scrollHeight); // 이 3가지 변수를 많이씀.
        if(window.scrollY + doc...clientHeight > docue...scrollHeight - 300) // 300px이전에 미리로딩하기
            {
                if (hasMorePost) {
                    dispatch({
                        type: LOAD_POSTS_REQUEST,
                    });
                }
            }
	}
	//window의 add-하면 scorll한것 remove-지워주어야함. 메모리에 계속쌓임
	window.addEventListener('scroll', onScroll);
	return() => {
		window.removeEventListener('scroll', onScorll);
	};
}, [])
```



- `clientHeight` : 화면이 보이는 길이 현재화면 위에서 아래까지
- `scrollY` : 제일 위에서부터, 얼마나 내렸는지 -> 옹 퍼센테이지로 볼 수 있겠네.
  - 이게 몇퍼센트면 어떤 컴포넌트를 보여주겠다 하면 팀원소개페이지 생각한대로 구현가능.
- `scrollHeight` : 총 길이 



실무에서는 특정 픽셀이 남았을 때 미리 로딩해주는 방식으로 사용함.

인피니트 스크롤 구현 + 리액트 버추얼라이즈드 구현해보면 좋음



---

###### 7. 학습 내용에 대한 개인적인 총평

- 인피니트스크롤을 위해 JS의 dom객체 메소드를 사용하는 것을 알게됨.
- 로그인, 로그아웃, 포스팅, 댓글삭제 등 모든 내용들이 saga, 리덕스를 통해 이루어진다. 반복해서 하는 것이 제일 중요하다고 생각했고, devtools를 적극 활용해야 디버깅도 빠름.

###### 8. 다음 학습 계획

- HTTP

