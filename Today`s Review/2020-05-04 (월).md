---
###### 1. 학습 날짜

- 2020-05 -04(월)
 
---
###### 2. 학습시간

- 10:00 ~ 14:00 (자가)

---
###### 3. 학습 범위 및 주제

- 스프링 학습
- 개발환경 세팅 및 DB연동
---
###### 4. 동료 학습 방법 

- slack (saji, yshin, Jiyang, Seongkim)

---
###### 5. 학습 목표 

- 스프링 학습

---
###### 6. 상세 학습 내용

- 코드작성시간 : 3 시간
## 스프링 프레임워크 설정하기 #01

https://all-record.tistory.com/176

- 스프링 프레임워크를 사용하기 위해 개발환경 설정이 중요하다.

- 해당 게시글에서는 설정하는 방법들을 정리할 것이다.

- 프로젝트 생성

  - New -> Project -> Spring하위파일의 LegacyProject -> 프로젝트 네임 설정 -> 상단 메뉴바의 Window -> Preferences에서 언어설정을 해주어야함

  ![UTF설정](https://user-images.githubusercontent.com/55486644/80931319-fe39ed80-8df3-11ea-9e16-47061599ed46.JPG)

  - 프로젝트 명 클릭 후, Properties선택 -> Resource에서 Text file encoding이 UTF- 8 로 설정되어있는지 확인,
  - Project Facets에서 Java가 1.8버전인지 확인하고, 아니면 1.8로 변경한다.



- web.xml에서 UTF-8로 변경하는 코드 작성
  - src->main->webapp->WEB-INF-web.xml에서, </web-app>위에 추가

```xml
<!--  문자 인코딩  시작 -->
<filter>
  <filter-name>encodingFilter</filter-name>
  <filter-class>
    org.springframework.web.filter.CharacterEncodingFilter
  </filter-class>
  <init-param>
    <param-name>encoding</param-name>
    <param-value>UTF-8</param-value>
  </init-param>
  <init-param>
    <param-name>forceEncoding</param-name>
    <param-value>true</param-value>
  </init-param>
</filter>
<filter-mapping>
  <filter-name>encodingFilter</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping>
<!--  문자 인코딩  끝 -->
```





- jsp에서도 인코딩을 UTF-8로 변경하는 코드 작성
  - src->main->webapp->WEB-INF->views->home.jsp

```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
```



- pom.xml 설정 변경, 의존성 추가

```xml
<properties>
		<java-version>1.6</java-version> //1.6을 1.8로 변경
		<org.springframework-version>3.1.1.RELEASE</org.springframework-version> <!--/3.1.1을 4.3.8로 변경버전은 유동적으로 변경함-->
		<org.aspectj-version>1.6.10</org.aspectj-version>
		<org.slf4j-version>1.6.6</org.slf4j-version>
	</properties>
```



- 서버생성
  - Servers탭에서 , New, 설치된 서버의 경로를 넣어준 뒤, next, Add하여 현재 서버를 사용할 프로젝트를 설정한다.



- 서버생성까지 완료되었다면, 프로젝트를 Run As , 하여, 서버가동을 확인해본다.
- ![서버가동](https://user-images.githubusercontent.com/55486644/80935728-fdf81d00-8e08-11ea-8dea-20f131df9b08.JPG)

## 스프링 CRUD #02 DB연동을 위한 세팅

[https://www.popit.kr/%EC%8B%A0%EC%9E%85-%EA%B0%9C%EB%B0%9C%EC%9E%90-%ED%95%99%EC%83%9D%EC%9D%84-%EC%9C%84%ED%95%9C-spring-mvc-setting-2%ED%8E%B8](https://www.popit.kr/신입-개발자-학생을-위한-spring-mvc-setting-2편)





- Mysql, MyBatis를  연동하기 위해선 어떤 의존성이 필요한지 알아야한다.
- mysql? - 자료를 저장할 오픈소스 데이터베이스
- MyBatis ? 자바의 관계형 데이터베이스 프로그래밍을 쉽게 도와주는 개발 프레임워크, JDBC를 통해 DB에 엑세스하는 작업을 캡슐화, 등. 프로그램코드와 SQL을 분리할 수 있는 장점을 가진다. [https://khj93.tistory.com/entry/MyBatis-MyBatis%EB%9E%80-%EA%B0%9C%EB%85%90-%EB%B0%8F-%ED%95%B5%EC%8B%AC-%EC%A0%95%EB%A6%AC](https://khj93.tistory.com/entry/MyBatis-MyBatis란-개념-및-핵심-정리)
- JDBC ? JavaDatabase Connectivity - 자바에서 DB프로그래밍을 하기 위해 사용되는 API(DB종류에 상관 없다.)https://dyjung.tistory.com/50



https://min-it.tistory.com/10https://min-it.tistory.com/10 -> **참고**

- DB연동을 위해선 , 의존성추가가 이루어져야한다. pom.xml에서 이를 추가한다. 원하는 의존성을 추가하고 싶으면  https://mvnrepository.com/ 해당 사이트에서 검색하여 많이쓰는, 원하는 의존성을 추가하면 된다.

```xml
   <!-- MySQL -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>6.0.5</version>
        </dependency>
 
        <!-- MyBatis 3.4.1 -->
        <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.4.1</version>
        </dependency>
 
 
        <!-- MyBatis-Spring -->
        <!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring -->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis-spring</artifactId>
            <version>1.3.0</version>
        </dependency>
 
        <!-- Spring-jdbc -->
        <!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>
 
        <!-- Spring-test -->
        <!-- https://mvnrepository.com/artifact/org.springframework/spring-test -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <version>${org.springframework-version}</version>
        </dependency>



출처: https://all-record.tistory.com/175 [세상의 모든 기록]
```

- DB연동을 위한 root-context.xml 수정
  - src->main->webapp->WEB-INF->spring->root-context.xml.
  - DB는 전체 프로젝트에서 사용하므로, root-context.xml에서 설정해야한다.

```xml
    <bean id="dataSource"
        class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"></property>
        <property name="url"
            value="jdbc:mysql://127.0.0.1:3306/board?useSSL=false&amp;serverTimezone=UTC">
        </property>
        <property name="username" value="root"></property>
        <property name="password" value="1234"></property>
    </bean> 
```

- DB의 쿼리문을 Java에 작성하는 것이 아닌 XML을 통해 읽어올 것이기 때문에, Mybatis에서 사용하는, SQLSessionFactoryBean을 정해준다.

```xml
  <!-- mybatis SqlSessionFactoryBean -->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"></property>
    </bean>

```



- root-context.xml의 namespace를 , aop, beans, context, jdbc, mybatis-spring 체크를 한다. (XML의 확장성을 위해)

- DB 테이블 생성
  - 워크밴치를 이용하여, table을 생성한다.
- 생성한 DB 테이블명, 계정이름, 비밀번호를 각각에 맞게 설정해준다음 테스트를 진행한다.

#### DB연동 확인

- src/test/java에 MyBatisTest, MySQLConnectionTest 클래스를 생성하며, 각각의 내용은 다음과 같다.

- MyBatisTest.java

```java
package my.board.crud;

import javax.inject.Inject;

import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
 
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"file:src/main/webapp/WEB-INF/spring/**/root-context.xml"})
public class MyBatisTest 
{
    @Inject
    private SqlSessionFactory sqlFactory;
    
    @Test
    public void testFactory(){
        System.out.println("\n >>>>>>>>>> sqlFactory 출력 : "+sqlFactory);
    }
    
    @Test
    public void testSession() throws Exception{
        
        try(SqlSession session = sqlFactory.openSession()){
            
            System.out.println(" >>>>>>>>>> session 출력 : "+session+"\n");
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

- MySQLConnectionTest.java

```java
package my.board.crud;


import java.sql.Connection;

import javax.inject.Inject;
import javax.sql.DataSource;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = { "file:src/main/webapp/WEB-INF/spring/**/root-context.xml" })
public class MySQLConnectionTest {
   
   @Inject
   private DataSource ds;

   @Test
   public void testConnection() throws Exception {

       try (Connection con = ds.getConnection()) {

           System.out.println("\n >>>>>>>>>> Connection 출력 : " + con + "\n");

       } catch (Exception e) {
           e.printStackTrace();
       }
   }
}
```

RunWith, Test어노테이션에서 에러가 나오는 것을 볼 수 있는데 이는 JUnit의 buildPath가 정해지지 않아서 이므로, 커서를 올려 해결할 수 있다.

Run As를 통해 실행해본다.

실행도중,  

```
정보: 적어도 하나의 JAR가 TLD들을 찾기 위해 스캔되었으나 아무 것도 찾지 못했습니다. 스캔했으나 TLD가 없는 JAR들의 전체 목록을 보시려면, 로그 레벨을 디버그 레벨로 설정하십시오. 스캔 과정에서 불필요한 JAR들을 건너뛰면, 시스템 시작 시간과 JSP 컴파일 시간을 단축시킬 수 있습니다.
```

해당오류가 발생했는데, 경로설정이 안이루어져서 발생한 오류이다.

해당 문제를 해결하기 위해서, Project Properties-> Deployment Assmebly -> Add -> Java Build Path Entries에서, Maven Dependencies, JUnit 둘다 Remove 후 , Add를 진행하여 해결할 수 있었다.

- 연동확인

![DB연동](https://user-images.githubusercontent.com/55486644/80936081-8a570f80-8e0a-11ea-9e8d-a8943f60a370.JPG)





- 기본적인 설정은 끝!
---
###### 7. 학습 내용에 대한 개인적인 총평

- 스프링 CRUD를 구현하기 위한 기본적인 세팅을 진행했다. 매번 이를 진행하기 위해 블로그 등 자료들을 참고했는데 아예 한꺼번에 정리했다. 도중에 서버구동이 제대로 되지않은 이슈가 있었는데, 프로젝트 빌드를 하지않고 다른걸 빌드해서 생겼던 오류였다.
- 7일까지 페이징, CRUD, 로그인 및 회원가입들을 구현하며 포트폴리오로 작성할 수준까지 만들 계획이다.
- 그런 수준까지 진행된다면 API 및 채팅 등 심화된 내용까지 구현할 것이다.
- 5일은 백준 문제 및 MVC패턴, 스프링 동작방식 대해 자세히 공부 할 예정이다.
---
###### 8. 다음 학습 계획
- 스프링 학습
- 백준 문제풀이
- 토이프로젝트 구상 및 구현 
- ft_printf 이슈 점검
- 평가진행하기
- 내용 정리