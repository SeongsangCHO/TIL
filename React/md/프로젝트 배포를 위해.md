## 프로젝트 배포를 위해..

<br>

회의에서 나온 키워드인 서버사이드 랜더링에 대해서 학습한다.

<br>

그리고 잘못알았던 것들도 다뤄볼 예정이다.

### 사이드 랜더링

서버사이드랜더링(SSR):

요청시마다 리다이렉트가 일어나며 서버에 새로운 페이지를 요청한다.

View가 어떻게 보여질지 서버에서 해석하여 클라이언트로 보내주는 것.

페이지를 서버측에서 간단하게 띄워주고, 완전히 랜더링된 페이지를 클라이언트에 다시 보내주는 기법이라한다.

클라이언트사이드랜더링(CSR):

이런 방식과 다르게 SPA기법이 나오게 되는데, 이 방식을 클라이언트사이드랜더링이라한다. 

하나의 빈페이지만 서버측에서 제공하고, View에 대해서는 Client에서 JS를 통해 렌더링하는 방식이라한다.

즉, View가 랜더링되는 위치가 서버인지, 클라이언트인지에 따라 달라진다. SPA === CSR은 아니다. SPA가 클라이언트사이드 랜더링방식을 사용하는 것이다.

#### 차이점

1. 초기 View 로딩속도.
2. SEO

SSR은 View를 서버에서 랜더링하여 가져오기 때문에 첫 로딩이 빠르다.  그러나 JS파일을 다운로드, 적용하기 전까지는 인터렉션에 반응하지 않는다.

CSR은 서버에서 랜더링하지 않고, HTML, JS 그리고 각종 리소스를 다운로드 받고 브라우져에서 랜더링하기때문에 초기 View로딩이 SSR보다 오래걸린다. 그러나 View가 보여준 시점에서는 바로 인터렉션이 가능하다.



<br>

SEO란 Search Engine Optimization. 검색 엔진 최적화이다.

CSR은 View를 생성하는데 JS가 필요하다. 따라서 로드되기 전까지 HTML은 비어있어서 웹 크롤러는 내용을 모르고, 제대로된 데이터 수집을 할 수 없다. SEO가 이루어지지 않으면, 검색엔진에 제대로 노출되지 않고, 유입이 줄어든다.

리액트에서 서버사이드랜더링을 적용하면, SEO의 단점을 극복할 수 있다.

[리액트 서버사이드랜더링](https://velopert.com/3425)



### 알게된 것

GCP를 사용하면서 VM과 IP에 대해서 알게된 것들이 있다.



GCP에는 내부, 외부 IP가 있다. 

내부IP: 모든 VM은 내부 IP를 갖고있으며, 같은 네트워크상의 VM들과 통신을 한다.

외부IP: 내, 외부(인터넷)통신이 가능하고, 임시로 생성한 IP를 고정으로 변경할 수 있다. 다른 네트워크, 다른 프로젝트의 VM간 통신이 가능하다.

[참고](https://whitechoi.tistory.com/23)



#### CORS 이슈

[참고]([https://firework-ham.tistory.com/70?category=868006#:~:text=CORS%EB%8A%94%20Cross%20Origin%20Resource,%EB%A5%BC%20%EC%B0%A8%EB%8B%A8%ED%95%98%EB%8A%94%20%EB%AC%B8%EC%A0%9C%EC%9E%85%EB%8B%88%EB%8B%A4.](https://firework-ham.tistory.com/70?category=868006#:~:text=CORS는 Cross Origin Resource,를 차단하는 문제입니다.))

### 문제점

리액트로 구성한 화면과 노드 서버를 같이 GCP상에서 배포하려고 계획했었다. 로컬에서는 둘다 구동이 되었는데, GCP상에서는 리액트프로젝트만 수행될 뿐. 동시에 되지 않을 뿐더러 노드 혼자서 구동도 되지 않았다.

어떤 것이 문제일까.

#### 했던 것들.

<br>

VM인스턴스에서 SSH접속.

프로젝트 Clone, 필요한 모듈 install.

<br>

리액트 App Build

`npm run build`로 프로젝트를 압축시킨 형태로 빌드한다. serve -s build로 빌드폴더를 실행하여 용량을 적게해서 배포할 수 있다.

<br>

리액트 package.json의 start스크립트에서 포트번호를 고정시켰다.

`PORT = 80 react ...`로 작성하고 `sudo npm run start`를 하니 외부 IP에서도 접속이 가능했는데, 그 이후에 같은 방법으로 다시 시도해봤지만 되지 않았따. 기존에는 `SET PORT= 8080 && ..`으로 작성했는데 마찬가지였다.

<br>

노드에서 server.js안의 포트번호를 3000, 5000, 80, 8080번으로 변경하고, iptables규칙으로 포트도 열고, 방화벽규칙도 따로 지정해두었지만 외, 내부에서도 접근이 되지 않았다. 아무래도 GCP, 배포에 대해 무언가를 모르는 것 같다.

 

#### 포트 규칙 설정하기



특정포트 외부에서 접속할 수 있도록 열기

`iptables -I INPUT 1 -p tcp --dport 포트번호 -j ACCEPT`



방화벽 설정정보 확인

`iptables -nL`



변경사항 저장

`service iptables save`



규칙 삭제

`iptables -D INPUT -p tcp --dport 포트번호 -j ACCEPT`





방화벽 활성화, 비활성화

`/etc/init.d/iptables start , stop`

<br>

### 알아야할 것

- nginx를 사용해야 하는지
- 다른 추가적인 기능 없이 노드 + 리액트로만 배포가 가능한지
- 리액트를  build하고 blank한 페이지 이슈 확인하기









